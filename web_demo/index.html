<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'self' 'wasm-unsafe-eval'; style-src 'self'; connect-src 'self'; img-src 'self'" />
  <title>SNOW2 Web Demo</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header>
    <div class="title">
      <h1>SNOW2 ❄️ Web Demo</h1>
      <p class="subtitle">A modern Rust tribute to Matthew Kwan’s SNOW. Runs 100% in your browser (WASM).</p>
    </div>
  </header>

  <main>
    <section class="card quickstart">
      <h2>Try it in 30 seconds</h2>
      <ol>
        <li>Enter a password in <b>Security Settings</b> below.</li>
        <li>Type a secret message (e.g. &ldquo;Meet at 8pm&rdquo;).</li>
        <li>Click <b>Encrypt &amp; Hide</b> &mdash; your message is encrypted and hidden inside normal-looking text!</li>
        <li>Copy the output or click <b>Download file</b> and send it anywhere (email, notes app, chat).</li>
        <li>To read it later: paste or <b>Upload</b> the file into <b>Step 2: Decrypt</b>, enter the same password &rarr; your message appears.</li>
      </ol>
    </section>

    <section class="card">
      <h2>Security settings</h2>

      <div class="grid">
        <label>
          Password
          <div class="pw-wrap">
            <input id="password" type="password" placeholder="Enter password" autocomplete="off" />
            <button type="button" class="pw-toggle" data-target="password" title="Show password">Show</button>
          </div>
        </label>

        <label>
          Pepper / "Signal Key" (optional)
          <div class="pw-wrap">
            <input id="pepper" type="password" placeholder="Optional second secret" autocomplete="off" />
            <button type="button" class="pw-toggle" data-target="pepper" title="Show pepper">Show</button>
          </div>
        </label>

        <label class="checkbox">
          <input id="pepperRequired" type="checkbox" />
          Require pepper to decrypt (authenticated policy)
        </label>
      </div>

      <details class="kdf-details">
        <summary>Advanced: password strength settings (Argon2id)</summary>
        <p class="note kdf-note">
          These control how hard it is to crack your password by guessing. Higher = slower but safer.
          The defaults are fine for most use. Browsers are limited to lower values than the CLI.
        </p>
        <div class="grid kdf">
          <label>
            Memory cost in MiB (Argon2 m_cost)
            <input id="kdfMib" type="number" min="8" max="128" step="8" value="64" />
          </label>

          <label>
            Passes / time cost (Argon2 t_cost)
            <input id="kdfIters" type="number" min="1" max="8" step="1" value="3" />
          </label>

          <label>
            Parallel lanes (Argon2 p_cost)
            <input id="kdfPar" type="number" min="1" max="4" step="1" value="1" />
          </label>
        </div>
      </details>

      <p class="note">
        Browser demo uses <b>websafe-zw</b> mode (zero-width embedding). Some platforms may strip zero-width characters.
        For strongest reliability, use the CLI with file-based carriers.
      </p>
      <div id="wasmStatus" class="status"></div>
    </section>

    <section class="card">
      <h2>Step 1: Encrypt &amp; Hide</h2>
      <label>
        Your secret message
        <textarea id="message" rows="4" placeholder="Type your secret message here..."></textarea>
      </label>

      <label>
        Cover text (your message will be hidden inside this)
        <textarea id="carrier" rows="10" placeholder="Paste any text here, or click 'Generate sample text' below..."></textarea>
      </label>

      <div class="row">
        <button id="genCarrier">Generate sample text</button>
        <button id="embedBtn">Encrypt &amp; Hide</button>
        <button id="clearAllBtn">Clear all</button>
      </div>

      <label>
        Output &mdash; looks normal, but your encrypted message is hidden inside
        <textarea id="outCarrier" rows="10" readonly></textarea>
      </label>

      <div class="row">
        <button id="copyCarrier">Copy to clipboard</button>
        <button id="downloadCarrier">Download file</button>
        <button id="toggleZw" class="toggle-zw">Show hidden markers</button>
      </div>

      <div id="embedStatus" class="status"></div>
    </section>

    <section class="card">
      <h2>Step 2: Decrypt &amp; Reveal</h2>
      <p class="note">
        Paste or upload the text containing a hidden message, enter the <b>same password</b>
        (and pepper, if used), then click <b>Decrypt</b>.
      </p>

      <div class="grid">
        <label>
          Password
          <div class="pw-wrap">
            <input id="extractPassword" type="password" placeholder="Enter password" autocomplete="off" />
            <button type="button" class="pw-toggle" data-target="extractPassword" title="Show password">Show</button>
          </div>
        </label>

        <label>
          Pepper / "Signal Key" (optional)
          <div class="pw-wrap">
            <input id="extractPepper" type="password" placeholder="Optional second secret" autocomplete="off" />
            <button type="button" class="pw-toggle" data-target="extractPepper" title="Show pepper">Show</button>
          </div>
        </label>
      </div>

      <label>
        Paste text containing a hidden message
        <textarea id="extractCarrier" rows="10" placeholder="Paste the text you received here..."></textarea>
      </label>

      <div class="row">
        <button id="uploadFileBtn">Upload file</button>
        <button id="extractBtn">Decrypt &amp; Reveal</button>
      </div>
      <input type="file" id="fileInput" hidden />

      <label>
        Your decrypted message
        <textarea id="recoveredText" rows="6" readonly></textarea>
      </label>

      <div class="row">
        <button id="downloadRecovered">Download file</button>
        <button id="clearExtractBtn">Clear</button>
      </div>

      <details class="b64-details">
        <summary>Raw data (base64)</summary>
        <textarea id="recoveredB64" rows="4" readonly></textarea>
      </details>

      <div id="extractStatus" class="status"></div>
    </section>

    <section class="card subtle">
      <h2>Tribute</h2>
      <p>
        SNOW2 is inspired by Matthew Kwan’s original SNOW — a clever, educational demo of whitespace steganography + encryption.
        This web demo is for learning and testing. Don’t treat browsers as a security boundary.
      </p>
    </section>
  </main>

  <footer>
    Full CLI version, classic trailing mode, post-quantum option &rarr;
    <a href="https://github.com/systemslibrarian/snow2" target="_blank" rel="noopener">GitHub repo</a>
  </footer>

  <script type="module" src="./app.js"></script>
</body>
</html>